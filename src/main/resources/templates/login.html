<!doctype html>
<!-- HTML5 の文書であることを宣言 -->
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<!-- ↑ Thymeleaf の属性（th:〜）を使用するための名前空間宣言 -->

<head>
    <meta charset="UTF-8">
    <title>ログイン</title>

    <!-- Bootstrap（CSSフレームワーク）を読み込み -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>

<body class="bg-light">
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-4">

            <h1 class="h4 mb-3 text-center">ログイン</h1>

            <!-- -----------------------------
                 ログイン失敗時のエラーメッセージ
                 Spring Security は ?error を自動付与
               ----------------------------- -->
            <div th:if="${param.error}" class="alert alert-danger">
                ユーザー名またはパスワードが正しくありません。
            </div>

            <!-- -----------------------------
                 ログアウト完了時のメッセージ
                 ?logout 付きで遷移した場合に表示
               ----------------------------- -->
            <div th:if="${param.logout}" class="alert alert-info">
                ログアウトしました。
            </div>

            <!-- -----------------------------
                 ログインフォーム
                 POST /login に送信する
                 （SecurityConfig で loginProcessingUrl("/login") を設定）
               ----------------------------- -->
            <form method="post" th:action="@{/login}">

                <!-- ユーザー名入力欄 -->
                <div class="mb-3">
                    <label for="username" class="form-label">ユーザー名</label>

                    <!-- name="username" が重要（Spring Security のデフォルト） -->
                    <input type="text" class="form-control" id="username"
                           name="username"
                           autocomplete="username" required>
                </div>

                <!-- パスワード入力欄 -->
                <div class="mb-3">
                    <label for="password" class="form-label">パスワード</label>

                    <!-- name="password" も Spring Security のデフォルト名称 -->
                    <input type="password" class="form-control" id="password"
                           name="password"
                           autocomplete="current-password" required>
                </div>

                <!-- ----------------------------------------------
                     ★CSRFトークン（セキュリティ上非常に重要）
                     Spring Security がリクエストごとに _csrf を自動提供

                     th:name  → _csrf.parameterName 例: "_csrf"
                     th:value → _csrf.token 例: "f342a98c-...-..."
                     hidden なのでユーザーには見えないが、POST 送信時に必須
                   ---------------------------------------------- -->
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}"/>

                <!-- 送信ボタン -->
                <button type="submit" class="btn btn-primary w-100">ログイン</button>
            </form>

        </div>
    </div>
</div>
</body>
</html>

